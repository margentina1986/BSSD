<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Admin</title>
    <link href="styles/Admin.css" rel="stylesheet" />
</head>

<body>

<h1>管理画面</h1>

<h2>一括処理</h2>
<div class="btn-group"><!--間隔を空けたボタンの作成-->
    <button type="button" id="importBtn">CSVインポート</button>
    <button type="button" id="runBtn">取込処理実行</button>
</div>
<!--エクスポートは別処理なので、インポートとは分けてボタン作成-->
<button type="button" id="exportBtn">CSVエクスポート</button>

<script>
/* ===== インポート処理 ===== */
let selectedFile = null;

// ファイル選択ボタン
document.getElementById('importBtn').addEventListener('click', function() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.csv';
    input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;

        // CSV以外はエラー
        if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
            alert('CSVファイルを選択してください');
            selectedFile = null;
            return;
        }

        selectedFile = file;
        alert(`${file.name} を選択しました。取込処理実行ボタンを押してください。`);
    };
    input.click();
});

// 取込処理実行ボタン
document.getElementById('runBtn').addEventListener('click', function() {
    if (!selectedFile) {
        alert('ファイルが選択されていません');
        return;
    }

    if (!confirm(`${selectedFile.name} を取り込みますか？\nデータは全件上書きされます`)) {
        return;
    }

    // ここでアップロード処理（Ajax等）を実装
    console.log('アップロード処理実行:', selectedFile);

    alert('データベースの更新が完了しました');

    // 選択リセット
    selectedFile = null;
});

/* ===== エクスポート処理 ===== */
document.getElementById('exportBtn').addEventListener('click', function() {
    if (!confirm('データベースからCSVをダウンロードしますか？')) return;

    // サーバー側で生成したCSVをダウンロード
    const url = 'download_csv.php'; // 例: CSV生成用PHP
    const a = document.createElement('a');
    a.href = url;
    a.download = 'export.csv'; // ダウンロードファイル名
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});
</script>

<h2>個別処理</h2>
<select name="job"><!--処理するテーブルをプルダウンで選択-->
    <option value="m_songs">楽曲マスタ</option>
    <option value="m_members">メンバーマスタ</option>
    <option value="m_parts">担当パートマスタ</option>
    <option value="m_instrument">担当楽器マスタ</option>
    <option value="m_performances">演奏曲マスタ</option>
</select>

<div class="btn-group"><!--選択されたテーブルのCRUDへ遷移　後ほどJavaScriptを作成-->
    <button type="button" onclick="location.href='遷移先URL'">一覧</button>
    <button type="button" onclick="location.href='遷移先URL'">追加</button>
    <button type="button" onclick="location.href='遷移先URL'">更新</button>
    <button type="button" onclick="location.href='遷移先URL'">削除</button>
</div>

</body>
</html>
